<?phprequire_once("../includes/initialize.php");// Redirect to index page if not logged inif(!$session->is_logged_in()) {  	redirect_to("../login.php");}$user = User::find_by_id($_SESSION['id']);?><!DOCTYPE html><html lang="en">  <head>    <meta charset="utf-8">    <title>PES Library</title>    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="description" content="This is the student home page">    <meta name="author" content="MadhurKapoor;AnandAgarwal">		<link href="../css/bootstrap.css" rel="stylesheet">    <style type="text/css">      body 	  {        padding-top: 60px;        padding-bottom: 40px;      }	   .sidebar-nav 	  {        padding: 9px 0;      }	</style>  </head>    <body>  <div class="navbar navbar-inverse navbar-fixed-top">      <div class="navbar-inner">        <div class="container-fluid">          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">            <span class="icon-bar"></span>            <span class="icon-bar"></span>            <span class="icon-bar"></span>          </button>          <a class="brand" href="#">PES Library</a>          <div class="nav-collapse collapse">            <p class="navbar-text pull-right">              Logged in as <a href="#" class="navbar-link"><?= $user->Name?></a>&nbsp;			  <button class="btn btn-inverse" onclick="location.href='../logout.php?logout';">SignOut&nbsp;</button>            </p>            <ul class="nav">              <li><a href="../student_home/student_home.php">Home</a></li>              <li><a href="../student_home/about.php">About</a></li>              <li><a href="../student_home/contact.php">Contact</a></li>            </ul>          </div><!--/.nav-collapse -->        </div>      </div>    </div>	<div style="text-align:center;" class="container">		<p class="lead"><h2>Welcome to the PES Library!!</h2></p>	</div>	<hr/>		<div class="container-fluid">		<div class="row-fluid">			<div class="span2">				<div class="well sidebar-nav">					<ul class="nav nav-list">						<li><a href="../issued/issued.php" data-toggle="tab"><b>Issued Books</b></a></li><br/>						<li><a href="../search/search.php" data-toggle="tab"><b>Search Books</b></a></li><br/>						<li><a href="../recommend/suggest.php" data-toggle="tab"><b>Suggest Books</b></a></li><br/>						<li><a href="../profile/profile.php" data-toggle="tab"><b>Profile</b></a></li><br/>						<li><a href="../changepwd/changepwd.php" data-toggle="tab"><b>Change Password</b></a></li><br/>						<li><a href="../suggestions/suggest.php" data-toggle="tab"><b>Suggestion Box</b></a></li><br/>					</ul>				</div>							</div>			<div class="span10">				<div class="tab-content">				<?php$check_count = $db->query("SELECT * FROM `reservation table` WHERE `user id` = '$user->Card_Number' AND `status` = 'live' ") ;$check_reference = $db->query("SELECT `Reference` FROM `table 3` WHERE `Id` = '$_GET[bookid]' ");$check_reserved = $db->query("SELECT `book id`, `user id` FROM `reservation table` WHERE `book id` = '$_GET[bookid]' AND `status`= 'live' ");$reference=$db->fetch_array($check_reference);$reserved=$db->fetch_array($check_reserved);if($reserved[0] && $reserved[1] != $user->Card_Number){	echo "Book has already been reserved<br/>";	die();}if($reference[0] == "Yes"){	echo "This book is a reference book, cannot be reserved <br/>";	die();}if ($db->num_rows($check_count) == 3){	echo "Sorry , You have exceeded the limit";	die();}else{	date_default_timezone_set('Asia/Kolkata'); // CDT	$info = getdate();	$date = $info['mday'];	$month = $info['mon'];	$year = $info['year'];	$today = "$year-$month-$date";	//fill the reservation table.	//change the status of the book in book table.	/*	Note:		whenever a reserved book is issued then 			the corresponding entry from the reservation table has to be removed.				A book reserved should be valid only for the duration of 3 days after the reservation.		After 3 days the reservation status should be 'expired'		Have to keep a seperate column entry in the reservation table indicating the status of reservation		i.e. wheteher a reservation is live or expired.					*/	//check if the user has already reserved the book.If so then do not allow him...	$check_entry = $db->query("SELECT * FROM `reservation table` WHERE `book id` = $_GET[bookid] AND `user id` = $user->Card_Number");	$row=$db->fetch_array($check_entry);	if($row)	{	   $status = $db->query("SELECT `status` FROM `reservation table` WHERE `book id` = $_GET[bookid] AND `user id` = $user->Card_Number");	   $row_status = $db->fetch_array($status);	   if ($row_status[0] =='live')	   {			echo "you have already reserved the book..";			echo "<br />";	   }	   else	   {			$db->query("INSERT INTO `reservation table`(`book id`, `user id`, `Date of reservation`, `status`) VALUES ('$_GET[bookid]','$user->Card_Number','$today','live')");			echo "reservation done";			echo "<br />";	   }	}	else	{		$status = "live";		$db->query("INSERT INTO `reservation table`(`book id`, `user id`, `Date of reservation`, `status`) VALUES ('$_GET[bookid]','$user->Card_Number','$today','$status')");		echo "reservation done";		echo "<br />";	}}?>	</div>								</div>						</div>			</div>	  </body></html>